<DataTable
  @content={{@content}}
  @fields={{@fields}}
  @page={{@page}}
  @size={{@size}}
  @sort={{@sort}}
  @filter={{@filter}}
  @hasMenu={{@hasMenu}}
  @selection={{@selection}}
  @noDataMessage={{@noDataMessage}}
  @isLoading={{@isloading}}
  @lineNumbers={{@lineNumbers}}
  @updatePage={{@updatePage}}
  @updatePageSize={{@updatePageSize}} {{!-- change to size or vice-versa? --}}
  @updateFilter={{@updateFilter}}
  @updateSort={{@updateSort}}
  as |dt|>
  {{!-- START: search --}}
  {{#if dt.enableSearch}}
    <dt.Search as |search|>
      {{#if (has-block "search")}}
        {{yield search to="search"}}
      {{else}}
        <div class="data-table-header">
          <div class="data-table-menu">
            <form
              {{on "submit" search.submitForm}}
              class="data-table-search">
              {{#if search.auto}}
                <label>Search:
                  <input
                    value={{search.filter}}
                    placeholder={{search.placeholder}}
                    {{on "input" search.handleAutoInput}} />
                </label>
              {{else}}
                <label>Search:
                  <input
                    value={{search.filter}}
                    placeholder={{search.placeholder}}
                    {{on "input" search.handleDirectInput}} />
                </label>
                <button type="submit">Search</button>
              {{/if}}
            </form>
          </div>
        </div>
      {{/if}}
    </dt.Search>
  {{/if}}
  {{!-- END: search --}}

  {{!-- START: menu --}}
  <dt.Menu as |General Selected|>
    {{#if (has-block "menu")}}
      {{yield (hash General Selected)}}
    {{else}}
      {{#if dt.dataTable.enableSelection}}
        <div class="data-table-menu">
          {{!-- either we have a general block or we have to have a menu --}}
          <General as |general|>
            {{#if general.data-table.selectionIsEmpty}}
              {{yield general.data-table to="general-menu"}}
            {{/if}}
          </General>
          <Selected as |selected|>
            {{#unless selected.data-table.selectionIsEmpty}}
              {{#if (has-block "selection-menu")}}
                {{yield selected to="selection-menu"}}
              {{else}}
                <span class="item-count">{{selected.selectionCount}} item(s) selected</span>
                <button type="button" {{on "click" selected.clearSelection}}>Cancel</button>
                {{yield (slice 0 selected.selectionCount selected.selection) selected.data-table
                    to="selection-menu-actions"}}
              {{/if}}
            {{/unless}}
          </Selected>
        </div>
      {{/if}}
    {{/if}}
  </dt.Menu>

  {{!-- END: menu --}}

  {{!-- START: content --}}

  <dt.Content as |content|>
    {{#if (has-block "content")}}
      {{yield content to="content"}}
    {{else}}
      <div class="data-table-content">
        <table class="data-table {{content.dataTable.tableClass}}">
          {{!-- START: headers --}}
          <content.Header as |header|>
            {{#if (has-block "full-header")}}
              {{yield header to="full-header"}}
            {{else}}
              <thead>
                <tr>
                  {{#if header.enableSelection}}
                    <th>{{!-- Checkbox --}}</th>
                  {{/if}}
                  {{#if header.enableLineNumbers}}
                    <th>{{!-- Linenumbers --}}</th>
                  {{/if}}
                  {{#if (has-block "data-headers")}}
                    {{yield (hash
                        parsedFields=header.parsedFields
                        currentSorting=header.currentSorting
                        updateSort=header.updateSort)
                        to="data-headers"}}
                  {{else}}
                    {{#each header.parsedFields as |field|}}
                      <DataTable::ThSortable
                        @field={{field}}
                        @label={{field}}
                        @currentSorting={{header.currentSorting}}
                        @updateSort={{header.updateSort}}
                        as |dataHeader|>
                        {{#if (has-block "data-header")}}
                          {{yield dataHeader to="data-header"}}
                        {{else}}
                          <th class={{concat "sortable" (if dataHeader.isSorted " sorted" "")}}>
                            <span role="button" {{on "click" dataHeader.inverseSorting}}>
                              {{#if dataHeader.order}}[{{dataHeader.order}}]{{/if}}
                              {{dataHeader.label}}
                            </span>
                          </th>
                        {{/if}}
                      </DataTable::ThSortable>
                    {{/each}}
                  {{/if}}
                </tr>
              </thead>
            {{/if}}
          </content.Header>
          {{!-- END: headers --}}

          {{!-- START: body --}}
          <content.Body as |body|>
            {{#if (has-block "body")}}
              {{yield body to="body"}}
            {{else}}
              <tbody>
                {{#if body.isLoading}}
                  {{#if (has-block "body-loading")}}
                    {{yield to="body-loading"}}
                  {{else}}
                    <tr><td colspan="100%" class="is-loading-data">Loading...</td></tr>
                  {{/if}}
                {{else}}
                  {{#if body.content}}
                    {{#each body.wrappedItems as |wrapper index|}}
                      {{#if (has-block "row")}}
                        {{yield (hash
                            wrapper=wrapper
                            item=wrapper.item
                            enableLineNumbers=body.enableLineNumbers
                            lineNumber=(add index body.offset)
                            selected=(includes wrapper.item body.selection)
                            hasClickRowAction=body.hasClickRowAction
                            onClickRow=(fn body.onClickRow wrapper.item)
                            toggleSelected=(fn body.toggleSelected wrapper))
                            to="row"}}
                      {{else}}
                        <tr role="button"
                          class="{{if (includes wrapper.item body.selection) "selected"}} {{if body.hasClickRowAction "clickable"}}"
                          {{on "click" (fn body.onClickRow wrapper.item)}}>
                          {{#if body.enableSelection}}
                            <td class="center">
                              {{input type="checkbox" checked=wrapper.isSelected click=(fn body.toggleSelected wrapper)}}
                            </td>
                          {{/if}}
                          {{#if body.enableLineNumbers}}
                            <td>{{add index body.offset}}</td>
                          {{/if}}
                          <body.DataCells @item={{wrapper.item}} as |dataCells|>
                            {{#if (has-block "data-cells")}}
                              {{yield dataCells to="data-cells"}}
                            {{else}}
                              {{#if dataCells.firstColumn}}
                                {{#if (has-block "first-data-cell")}}
                                  {{yield (hash
                                      columns=dataCells.columns
                                      firstColumn=dataCells.firstColumn
                                      otherColumns=dataCells.otherColumns
                                      item=dataCells.item
                                      linkedRoute=dataCells.linkedRoute
                                      field=(get dataCells.item dataCells.firstColumn))
                                      to="first-data-cell"}}
                                {{else if (has-block "data-cell")}}
                                  {{yield (hash
                                      columns=dataCells.columns
                                      firstColumn=dataCells.firstColumn
                                      otherColumns=dataCells.otherColumns
                                      item=dataCells.item
                                      linkedRoute=dataCells.linkedRoute
                                      field=(get dataCells.item dataCells.firstColumn))
                                      to="data-cell"}}
                                {{else}}
                                  {{#if dataCells.linkedRoute}}
                                    {{#link-to dataCells.linkedRoute dataCells.item tagName="td"}}{{get dataCells.item dataCells.firstColumn}}{{/link-to}}
                                  {{else}}
                                    <td>{{get dataCells.item dataCells.firstColumn}}</td>
                                  {{/if}}
                                {{/if}}
                              {{/if}}
                              {{#each dataCells.otherColumns as |field|}}
                                {{#let (hash
                                     columns=dataCells.columns
                                     firstColumn=dataCells.firstColumn
                                     otherColumns=dataCells.otherColumns
                                     item=dataCells.item
                                     linkedRoute=dataCells.linkedRoute
                                     field=(get dataCells.item field))
                                     as |data-cell-data|}}
                                  {{#if (has-block "rest-data-cell")}}
                                    {{yield data-cell-data to="rest-data-cell"}}
                                  {{else if (has-block "data-cell")}}
                                    {{yield data-cell-data to="rest-data-cell"}}
                                  {{else}}
                                    <td>
                                      {{!-- TODO: This should be based on the type of the field --}}
                                      {{get dataCells.item field}}
                                    </td>
                                  {{/if}}
                                {{/let}}
                              {{/each}}
                            {{/if}}
                          </body.DataCells>
                        </tr>
                      {{/if}}
                    {{/each}}
                  {{else}}
                    {{#if (has-block "no-data-message")}}
                      {{yield to="no-data-message"}}
                    {{else}}
                      <tr><td colspan="100%" class="no-data-message"><p>{{@noDataMessage}}</p></td></tr>
                    {{/if}}
                  {{/if}}
                {{/if}}
              </tbody>
            {{/if}}
          </content.Body>
          {{!-- END: body --}}
        </table>
      </div>
    {{/if}}
  </dt.Content>

  {{!-- END: content --}}

  {{!-- START: pagination --}}
  <dt.Pagination as |pagination|>
    {{#if @content}}
      {{#if (has-block "pagination")}}
        {{yield pagination to="pagination"}}
      {{else}}
        <div class="data-table-pagination">
          <div class="data-table-pagination-left">
            Displaying {{pagination.startItem}}-{{pagination.endItem}}
            {{#if pagination.total}} of {{pagination.total}}{{/if}}
            {{#if pagination.sizeOptions}}
              |
              <label>
                <select {{on "change" pagination.selectSizeOption}} value="target.value">
                  {{#each pagination.sizeOptions as |sizeOption|}}
                    <option value={{sizeOption}} selected={{eq pagination.size sizeOption}}>{{sizeOption}}</option>
                  {{/each}}
                </select> per page
              </label>
            {{/if}}
          </div>
          {{#if pagination.hasMultiplePages}}
            <div class="data-table-pagination-right">
              <button disabled={{pagination.isFirstPage}} type="button" {{on "click" (fn pagination.updatePage pagination.links.first)}}>First</button>
              <button disabled={{pagination.isFirstPage}} type="button" {{on "click" (fn pagination.updatePage pagination.links.prev)}}>Previous</button>

              <button disabled={{pagination.isLastPage}} type="button" {{on "click" (fn pagination.updatePage pagination.links.next)}}>Next</button>
              <button disabled={{pagination.isLastPage}} type="button" {{on "click" (fn pagination.updatePage pagination.links.last)}}>Last</button>
            </div>
          {{/if}}
        </div>
      {{/if}}
    {{/if}}
  </dt.Pagination>
  {{!-- END: pagination --}}
</DataTable>